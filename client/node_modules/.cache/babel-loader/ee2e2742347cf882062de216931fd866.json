{"ast":null,"code":"var _jsxFileName = \"/home/yoojin/Development/code/phase_5/project/client/src/Components/PostPhotos.js\",\n    _s = $RefreshSig$();\n\n/* eslint-disable jsx-a11y/alt-text */\n// @ts-nocheck\nimport React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Error } from '../Styles/NewFilm.style'; // Styling\n\nimport { PostPhotoContainer } from '../Styles/PostPhotos.style';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction PostPhotos(_ref) {\n  _s();\n\n  let {\n    currentSlideId,\n    currentUser,\n    updatingIsReleased,\n    slideshows\n  } = _ref;\n  const [selectedImages, setSelectedImages] = useState([]);\n  const [error, setError] = useState(\"\");\n  const history = useHistory();\n  useEffect(() => {\n    if (!currentUser) {\n      fetch('/me').then(res => {\n        if (!res.ok) {\n          history.push('/loginerror');\n        }\n      });\n    }\n  }, []);\n\n  function imageHandleChange(e) {\n    if (e.target.files) {\n      const fileArray = Array.from(e.target.files).map(file => URL.createObjectURL(file));\n      setSelectedImages(images => images.concat(fileArray));\n      Array.from(e.target.files).map(file => URL.revokeObjectURL(file));\n    }\n  }\n\n  function renderPhotos(source) {\n    return source.map(photo => {\n      return /*#__PURE__*/_jsxDEV(\"img\", {\n        src: photo,\n        className: \"renderedPhotos\",\n        onClick: () => renderDelete(photo)\n      }, photo, false, {\n        fileName: _jsxFileName,\n        lineNumber: 39,\n        columnNumber: 14\n      }, this);\n    });\n  }\n\n  function renderDelete(source) {\n    const updatedList = [...selectedImages];\n    updatedList.splice(selectedImages.indexOf(source), 1);\n    setSelectedImages(updatedList);\n  }\n\n  const slideshowPhotos = slideshows.filter(item => item.id == currentSlideId)[0].photos;\n\n  function handleSubmit(e) {\n    e.preventDefault();\n    const data = new FormData();\n    const uploadingImages = e.target.image.files;\n\n    for (let i = 0; i < uploadingImages.length; i++) {\n      data.append(\"image\", e.target.image.files[i]);\n      data.append(\"slideshow_id\", currentSlideId);\n\n      if (slideshowPhotos.length === 0) {\n        setTimeout(() => {\n          patchToAPI(data);\n        }, 500);\n      } else {\n        setTimeout(() => {\n          submitToAPI(data);\n        }, 500);\n      }\n    }\n\n    setTimeout(() => {\n      handleUpdate(data);\n    }, 500);\n  }\n\n  console.log(slideshowPhotos.length);\n\n  function submitToAPI(data) {\n    fetch('/photos', {\n      method: 'POST',\n      body: data\n    }).then(res => res.json()).catch(error => console.error(error));\n  }\n\n  function patchToAPI(data) {\n    fetch(`/photos/${slideshowPhotos.id}`, {\n      method: 'PATCH',\n      body: data\n    }).then(res => res.json()).catch(error => console.log(error));\n  }\n\n  function handleUpdate(data) {\n    if (data) {\n      fetch(`/slideshows/${currentSlideId}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          isReleased: true\n        })\n      }).then(res => res.json()).then(res => {\n        updatingIsReleased(res);\n        history.push(`/user/${currentUser.id}`);\n      });\n    } else {\n      setError(\"Please submit photos\");\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(PostPhotoContainer, {\n    children: [error ? /*#__PURE__*/_jsxDEV(Error, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-text\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 23\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 16\n    }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"center-grid\",\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: e => handleSubmit(e),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"first-column\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"first-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"Choose the most epic photo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n              children: \"from your travel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\" // multiple \n              ,\n              name: \"image\",\n              id: \"image\",\n              onChange: imageHandleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"image-container\",\n          children: renderPhotos(selectedImages)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-grid\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"back\",\n            onClick: () => history.push(`/editfilm/${currentSlideId}`),\n            children: \"Back\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"submit\",\n            children: \"Submit Film\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 109,\n    columnNumber: 5\n  }, this);\n}\n\n_s(PostPhotos, \"KpYdVQ/wOnbVqLsApF7HmKNxYhM=\", false, function () {\n  return [useHistory];\n});\n\n_c = PostPhotos;\nexport default PostPhotos;\n\nvar _c;\n\n$RefreshReg$(_c, \"PostPhotos\");","map":{"version":3,"names":["React","useState","useEffect","useHistory","Error","PostPhotoContainer","PostPhotos","currentSlideId","currentUser","updatingIsReleased","slideshows","selectedImages","setSelectedImages","error","setError","history","fetch","then","res","ok","push","imageHandleChange","e","target","files","fileArray","Array","from","map","file","URL","createObjectURL","images","concat","revokeObjectURL","renderPhotos","source","photo","renderDelete","updatedList","splice","indexOf","slideshowPhotos","filter","item","id","photos","handleSubmit","preventDefault","data","FormData","uploadingImages","image","i","length","append","setTimeout","patchToAPI","submitToAPI","handleUpdate","console","log","method","body","json","catch","headers","JSON","stringify","isReleased"],"sources":["/home/yoojin/Development/code/phase_5/project/client/src/Components/PostPhotos.js"],"sourcesContent":["/* eslint-disable jsx-a11y/alt-text */\n// @ts-nocheck\nimport React, { useState, useEffect } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport { Error } from '../Styles/NewFilm.style'\n// Styling\nimport { PostPhotoContainer } from '../Styles/PostPhotos.style'\n\nfunction PostPhotos({currentSlideId, currentUser, updatingIsReleased, slideshows}) {\n  \n  const [ selectedImages, setSelectedImages ] = useState([])\n  const [ error, setError ] = useState(\"\")\n\n  const history = useHistory()\n\n  useEffect(() => {\n    if (!currentUser) {\n      fetch('/me').then((res) => {\n        if (!res.ok) {\n            history.push('/loginerror')\n        }\n      })\n    }\n  }, [])\n\n  function imageHandleChange(e) {\n    if(e.target.files) {\n      const fileArray = Array.from(e.target.files).map((file) => URL.createObjectURL(file))\n      \n      setSelectedImages((images) => images.concat(fileArray))\n      Array.from(e.target.files).map(\n        (file) => URL.revokeObjectURL(file)\n      )\n    }\n  }\n\n  function renderPhotos(source) {\n    return source.map((photo) => {\n      return <img \n        src={photo} \n        key={photo} \n        className='renderedPhotos' \n        onClick={() => renderDelete(photo)}\n      />\n    })\n  }\n\n  function renderDelete(source) {\n    const updatedList = [...selectedImages]\n    updatedList.splice(selectedImages.indexOf(source), 1)\n    setSelectedImages(updatedList)\n  }\n\n\n  const slideshowPhotos = slideshows.filter((item) => item.id == currentSlideId)[0].photos\n\n  function handleSubmit(e) {\n    e.preventDefault()\n    const data = new FormData()\n    const uploadingImages = e.target.image.files\n\n    for (let i = 0; i < uploadingImages.length; i++) {\n      data.append(\"image\", e.target.image.files[i])\n      data.append(\"slideshow_id\", currentSlideId)\n      \n      if (slideshowPhotos.length === 0) {\n        setTimeout(() => {patchToAPI(data)}, 500)\n      } else {setTimeout(() => {submitToAPI(data)}, 500)}\n    }\n    setTimeout(() => {handleUpdate(data)}, 500)\n  }\nconsole.log(slideshowPhotos.length)\n  function submitToAPI(data) {\n    fetch('/photos', {\n      method: 'POST',\n      body: data,\n    })\n      .then(res => res.json())\n      .catch((error) => console.error(error))\n  }\n\n  function patchToAPI(data) {\n    fetch(`/photos/${slideshowPhotos.id}`, {\n      method: 'PATCH',\n      body: data,\n    })\n      .then(res => res.json())\n      .catch((error) => console.log(error))\n  }\n\n  function handleUpdate(data) {\n    if (data) {\n      fetch(`/slideshows/${currentSlideId}`, {\n        method: 'PATCH',\n        headers: {'Content-Type': 'application/json'},\n        body: JSON.stringify({\n          isReleased: true\n        })\n      })\n        .then(res => res.json())\n        .then(res => {\n          updatingIsReleased(res)\n          history.push(`/user/${currentUser.id}`)\n        })\n    } else {setError(\"Please submit photos\")}\n  }\n\n  return (\n    <PostPhotoContainer>\n      {error ? <Error><div className='error-text'>{error}</div></Error> : null}\n      <div className='center-grid'>\n        <form onSubmit={(e) => handleSubmit(e)}>\n          <div className='first-column'>\n            <div className='first-row'>\n              <h2>Choose the most epic photo</h2>\n              <h2>from your travel</h2>\n              <input \n                type='file' \n                // multiple \n                name='image' \n                id='image'\n                onChange={imageHandleChange}\n              />\n            </div>\n          </div>\n          <div className='image-container'>\n            {renderPhotos(selectedImages)}\n          </div>\n          <div className='button-grid'>\n              <button className='back' onClick={() => history.push(`/editfilm/${currentSlideId}`)}>Back</button>\n              <button type='submit' className='submit'>Submit Film</button>\n          </div>\n        </form>\n      </div>\n    </PostPhotoContainer>\n  )\n}\n\nexport default PostPhotos"],"mappings":"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"},"metadata":{},"sourceType":"module"}